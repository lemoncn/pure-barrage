{"version":3,"sources":["Bullet.ts","../node_modules/object-assign/index.js","Barrage.ts"],"names":["getOwnPropertySymbols","Object","hasOwnProperty","prototype","propIsEnumerable","propertyIsEnumerable","toObject","val","TypeError","shouldUseNative","assign","test1","String","getOwnPropertyNames","test2","i","fromCharCode","order2","map","n","join","test3","split","forEach","letter","keys","err","module","exports","target","source","from","symbols","to","s","arguments","length","key","call"],"mappings":"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","file":"Barrage.js","sourceRoot":"..\\src","sourcesContent":["/**\r\n * 子弹\r\n */\r\nimport './type'; //  数据类型\r\n\r\nclass Bullet {\r\n    private oBullet: HTMLSpanElement;\r\n\r\n    /**\r\n     * @constructor Bullet\r\n     * @param {string} msg 弹幕文字\r\n     * @param {EmitConfig} emitConfig   弹幕文字效果 \r\n     * @param {config} stageConfig 弹幕组件初始化配置\r\n     * \r\n     */\r\n    constructor(msg: string, emitConfig: EmitConfig, stageConfig: config) {\r\n        var that = this;\r\n        that.oBullet = document.createElement(\"div\");\r\n        that.oBullet.innerHTML = msg;\r\n        that.oBullet.className = \"barrage-bullet\";\r\n\r\n        //  着重标记\r\n        if (emitConfig.notice) {\r\n            that.oBullet.className += \" barrage-bullet-notice\";\r\n        }\r\n\r\n        // class拓展\r\n        if (emitConfig.className) {\r\n            that.oBullet.className += \" \" + emitConfig.className;\r\n        }\r\n\r\n        //  字号\r\n        if (emitConfig.fontSize) {\r\n            that.oBullet.style.fontSize = emitConfig.fontSize;\r\n        }\r\n\r\n        //  字色\r\n        if (emitConfig.fontColor) {\r\n            that.oBullet.style.color = emitConfig.fontColor;\r\n        }\r\n\r\n        // 速度\r\n        // 弹幕速度通过时间控制：overTimeBase\r\n        let time = stageConfig.overTimeBase;\r\n        switch (emitConfig.speed) {\r\n            case 'fast':\r\n                time = time * (Math.random() * (1.3 - 0.8) + 0.4);\r\n                break;\r\n            case 'slow':\r\n                time = time * (Math.random() * (1.3 - 0.8) + 1.2);\r\n                break;\r\n            default:\r\n                time = time * (Math.random() * (1.3 - 0.8) + 0.8);\r\n        }\r\n        that.oBullet.style.transitionDuration = time / 1000 + \"s\";\r\n    }\r\n\r\n    /**\r\n     * 获取子弹dom\r\n     * @function get\r\n     * @returns {HTMLSpanElement} \r\n     * \r\n     */\r\n    get(): HTMLSpanElement {\r\n        return this.oBullet;\r\n    }\r\n}\r\n\r\nexport default Bullet;\r\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","/**\r\n * 弹幕类\r\n * @author Lemon\r\n */\r\n\r\nimport './type'; //  数据类型\r\nimport Bullet from './Bullet'; //  弹幕子弹\r\nconst objectAssign = require('object-assign');\r\n\r\nclass Barrage {\r\n  private config: config; //  实例配置\r\n  private width: number; // 弹幕舞台宽度\r\n  private height: number; // 弹幕舞台高度\r\n  private lastTop: number; //   最后一个弹幕发射的y坐标\r\n\r\n  /**\r\n   * @constructor Barrage\r\n   * \r\n   * @param {config} config \r\n   * @param {Object} config.container - 弹幕区域的dom对象\r\n   * @param {Number} config.overTimeBase - 弹幕划过的时间基准（弹幕划过所需要的时间，默认5000  即5s）\r\n   */\r\n  constructor(config: config) {\r\n    let that = this;\r\n    // 初始化默认配置\r\n    that.config = objectAssign({\r\n      container: window.document.body,\r\n      overTimeBase: 6000\r\n    }, config);\r\n\r\n    that.width = that.config.container.clientWidth;\r\n    that.height = that.config.container.clientHeight;\r\n    that.lastTop = 0;\r\n\r\n    that.styleInit();\r\n  }\r\n\r\n  /**\r\n   * 样式初始化\r\n   * @function  styleInit\r\n   * @private\r\n   */\r\n  private styleInit() {\r\n    let that = this;\r\n    // 给弹幕容器加class调用\r\n    that.config.container.className += ' fe-plus-barrage';\r\n\r\n    let oHead: HTMLElement = document.getElementsByTagName('head')[0];\r\n    let oStyle: any = document.createElement('style');\r\n    oStyle.type = 'text/css';\r\n    let sCSS = [\r\n      '.fe-plus-barrage{overflow: hidden}',\r\n      '.fe-plus-barrage .barrage-bullet{position: absolute;left: 100%;top: 0px;z-index: 100;white-space: nowrap;color: #fff;line-height: 160%;text-shadow: 1px 1px 0px rgba(0,0,0,.4);transition: transform 3s linear;}',\r\n      '.fe-plus-barrage .barrage-bullet-notice{font-weight: bold;color:red}',\r\n    ].join('');\r\n    if (oStyle.styleSheet) {\r\n      oStyle.styleSheet.cssText = sCSS;\r\n    } else {\r\n      oStyle.innerHTML = sCSS;\r\n    }\r\n    oHead.appendChild(oStyle);\r\n  }\r\n\r\n  /**\r\n   * 发射弹幕\r\n   * @function emit\r\n   * @param {string} msg \r\n   * @param {EmitConfig} [emitConfig] 拓展样式\r\n   * @param {boolean} [emitConfig.notice] 是否是重点弹幕（加大加粗）\r\n   * @param {string} [emitConfig.fontSize] 字号 “12px”\r\n   * @param {string} [emitConfig.fontColor] 字色“#ff0”\r\n   */\r\n  emit(msg: string, emitConfig?: EmitConfig) {\r\n    const that = this;\r\n    const oEmitConfig: EmitConfig = emitConfig || {};\r\n\r\n    //  获取弹幕子弹元素\r\n    const bullet = new Bullet(msg, oEmitConfig, that.config).get();\r\n\r\n    //  render dom，获取其占位尺寸\r\n    that.config.container.appendChild(bullet);\r\n\r\n    let bulletWidth: number = bullet.clientWidth;\r\n    let bulletHeight: number = bullet.clientHeight;\r\n\r\n    //  top值\r\n    // that.lastTop += bulletHeight + Math.random() * 30;\r\n    that.lastTop += bulletHeight + 0;\r\n    if (that.lastTop + bulletHeight > that.height) {\r\n      that.lastTop = 0;\r\n    }\r\n    bullet.style.top = that.lastTop + 'px';\r\n\r\n    // 移出屏幕偏移量\r\n    let moveX: number = that.width + bulletWidth;\r\n\r\n    //  开始单条弹幕\r\n    bullet.style.transform = 'translate3d(' + -moveX + 'px, 0,0)';\r\n\r\n    //  动画结束消除自己\r\n    function _removeBullet() {\r\n      if (bullet.parentNode) {\r\n        bullet.removeEventListener('webkitTransitionEnd', _removeBullet);\r\n        bullet.removeEventListener('transitionend', _removeBullet);\r\n        bullet.parentNode.removeChild(bullet);\r\n      }\r\n    }\r\n    bullet.addEventListener('webkitTransitionEnd', _removeBullet);\r\n    bullet.addEventListener('transitionend', _removeBullet);\r\n  }\r\n\r\n}\r\n\r\nexport default Barrage;\r\n"]}